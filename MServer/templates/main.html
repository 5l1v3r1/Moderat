{% extends "admin/base_site.html" %}
{% load i18n admin_static %}

{% block title %}
  ModeRat Server Dashboard
{% endblock %}

{% block extrajs %}
<script type="text/javascript">
    function init() {
        Highcharts.chart('cpuGauge', {

        chart: {
            type: 'gauge'
        },
        title: {
            text: null
        },
        credits: {
            enabled: false
        },
        pane: {
            startAngle: -150,
            endAngle: 150,
            background: [{
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#FFF'],
                        [1, '#333']
                    ]
                },
                borderWidth: 0,
                outerRadius: '10ds9%'
            }, {
                backgroundColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0, '#333'], [1, '#FFF']
                    ]
                },
                borderWidth: 1,
                outerRadius: '107%'
            }, {
                // default background
            }, {
                backgroundColor: '#DDD',
                borderWidth: 0,
                outerRadius: '105%',
                innerRadius: '103%'
            }]
        },

        // the value axis
        yAxis: {
            min: 0,
            max: 100,

            minorTickInterval: 'auto',
            minorTickWidth: 1,
            minorTickLength: 10,
            minorTickPosition: 'inside',
            minorTickColor: '#666',

            tickPixelInterval: 30,
            tickWidth: 2,
            tickPosition: 'inside',
            tickLength: 10,
            tickColor: '#666',
            labels: {
                step: 2,
                rotation: 'auto'
            },
            title: {
                text: 'CPU'
            },
            plotBands: [{
                from: 0,
                to: 60,
                color: '#55BF3B' // green
            }, {
                from: 60,
                to: 80,
                color: '#DDDF0D' // yellow
            }, {
                from: 80,
                to: 100,
                color: '#DF5353' // red
            }]
        },

        series: [{
            name: 'CPU Usage',
            data: [{{ machine.cpu_percent }}],
        }]
    })
        Highcharts.chart('memoryGauge', {
    chart: {
        type: 'gauge',
    },
    title: {
        text: null
    },
    credits: {
        enabled: false
    },
    pane: {
        startAngle: -150,
        endAngle: 150,
        background: [{
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#FFF'],
                    [1, '#333']
                ]
            },
            borderWidth: 0,
            outerRadius: '10ds9%'
        }, {
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#333'],
                    [1, '#FFF']
                ]
            },
            borderWidth: 1,
            outerRadius: '107%'
        }, {
            // default background
        }, {
            backgroundColor: '#DDD',
            borderWidth: 0,
            outerRadius: '105%',
            innerRadius: '103%'
        }]
    },

    // the value axis
    yAxis: {
        min: 0,
        max: 100,

        minorTickInterval: 'auto',
        minorTickWidth: 1,
        minorTickLength: 10,
        minorTickPosition: 'inside',
        minorTickColor: '#666',

        tickPixelInterval: 30,
        tickWidth: 2,
        tickPosition: 'inside',
        tickLength: 10,
        tickColor: '#666',
        labels: {
            step: 2,
            rotation: 'auto'
        },
        title: {
            text: 'RAM'
        },
        plotBands: [{
            from: 0,
            to: 60,
            color: '#55BF3B' // green
        }, {
            from: 60,
            to: 80,
            color: '#DDDF0D' // yellow
        }, {
            from: 80,
            to: 100,
            color: '#DF5353' // red
        }]
    },
    series: [{
        name: 'Memory Usage',
        data: [{{ machine.memory_usage }}],
        }]
    })
        Highcharts.chart('clientModeratorStatistic', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'Clients & Moderators Statistic'
    },
    xAxis: {
        categories: ['Clients', 'Moderators'],
        title: {
            text: null
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: null,
            align: 'high'
        },
        labels: {
            overflow: 'justify'
        }
    },
    plotOptions: {
        bar: {
            dataLabels: {
                enabled: true
            }
        }
    },
    credits: {
        enabled: false
    },
    series: [{
        name: 'Total',
        data: [{{ clients.total }}, {{ moderators.total }}],
        color: '#333333'
        }, {
          name: 'Offline',
          data: [{{ clients.offline }}, {{ moderators.offline }}],
          color: '#e74c3c'
        }, {
            name: 'Online',
            data: [{{ clients.online }}, {{ moderators.online }}],
            color: '#2ecc71'
        }]
    })

        Highcharts.chart('logStatistic', {
    chart: {
        type: 'bar'
    },
    title: {
        text: 'Logs Statistic'
    },
    xAxis: {
        categories: ['Logs',]
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Total Logs'
        }
    },
    legend: {
        reversed: true
    },
    plotOptions: {
        series: {
            stacking: 'normal'
        }
    },
    series: [{
        name: 'Screenshots',
        data: [{{ screenshots.total }},]
    }, {
        name: 'Keylogs',
        data: [{{ keylogs.total }},]
    }, {
        name: 'Audios',
        data: [{{ audios.total }},]
    }]
    })

    }
    window.onload = init;
</script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('upcoming', {'packages':['geochart']});
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {

        var data = google.visualization.arrayToDataTable([
          ['Country', 'Clients'],
            {% for client in clientsGeo %}
              ['{{ client.country }}', '{{ client.count }}'],
            {% endfor %}
        ]);

        var options = {
            backgroundColor: 'transparent',
            colorAxis: {colors: ['#f1c40f', '#c0392b']},
        };

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        chart.draw(data, options);
      }
    </script>

{% endblock %}

{% block content %}
  {% block dashboard_highcharts_js %}
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/highcharts-more.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
  {% endblock %}

  {% block main %}
    <div class="row-fluid">
      <div class="span5">
        <div class="row-fluid">
          <div class="span12">
            <div id="cpuGauge" class="span6" style="min-width: 200px; height: 200px; margin: auto auto"></div>
            <div id="memoryGauge" class="span6" style="min-width: 200px; height: 200px; margin: auto auto"></div>
          </div>
          <div class="span12">
            <table class="table">
            <tr>
              <td>Uptime:</td>
              <td>{{ machine.uptime }}</td>
            </tr>
            <tr>
              <td>Hostname:</td>
              <td>{{ machine.hostname }}</td>
            </tr>
            <tr>
              <td>System:</td>
              <td>{{ machine.system }}</td>
            </tr>
            <tr>
              <td>Architecture:</td>
              <td>{{ machine.architecture }}</td>
            </tr>
            <tr>
              <td>Python Version:</td>
              <td>{{ machine.python_version }}</td>
            </tr>
        </table>
          </div>

        </div>
      </div>
      <div class="span3">
        <div id="clientModeratorStatistic" class="col-lg-12"></div>
      </div>
      <div class="span4">
        <div id="logStatistic" class="col-lg-12"></div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span12">
        <p class="btn btn-active text-center span12">Clients Map</p>
      </div>
      <div class="span12" id="regions_div" style="width: 1040px; height: 500px;"></div>
    </div>
  {% endblock %}

{% endblock %}